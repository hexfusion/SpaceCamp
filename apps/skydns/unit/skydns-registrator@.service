[Unit]
Description=Registers container in SkyDNS

Requires=etcd.service
After=etcd.service

[Service]
Restart=always
RestartSec=10s

ExecStartPre=/usr/bin/bash -c "/usr/bin/systemctl set-environment PUBLIC_IPV4=$(hostname -I)"
ExecStart=/usr/bin/bash -c "\
    while true; do \
        etcdctl set /skydns/spacecamp/%I '{\"host\": \"${PUBLIC_IPV4}\", \"ttl\": 30}' --ttl 30; \
        sleep 20; \
    done"

ExecStop=/usr/bin/etcdctl rm /skydns/spacecamp/%I

[X-Fleet]
Global=true
